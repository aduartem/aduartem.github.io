<div class="toc toc-collapsed">
  <div class="toc-header">
    <h4>üìö Contenido</h4>
    <button id="toc-toggle" aria-label="Desplegar contenido">‚ñº</button>
  </div>
  <div class="toc-content">
    <ul id="markdown-toc"></ul>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
    const toc = document.getElementById('markdown-toc');
    const tocContainer = document.querySelector('.toc');
    const tocToggle = document.getElementById('toc-toggle');

    // Si no hay encabezados, ocultar el TOC completamente
    if (headings.length === 0) {
      tocContainer.style.display = 'none';
      return;
    }

    // Crear una variable para contar los √≠tems agregados
    let addedItems = 0;

    // Generar la tabla de contenidos
    headings.forEach(function (heading, index) {
      // Usar el ID existente del encabezado si est√° presente, o crear uno nuevo
      const id = heading.id || 'heading-' + index;
      heading.id = id; // Asignar ID si no tiene uno

      const li = document.createElement('li');
      const a = document.createElement('a');
      a.textContent = heading.textContent;
      a.href = '#' + id;

      // A√±adir clases seg√∫n el nivel del encabezado
      switch (heading.tagName) {
        case 'H1': li.classList.add('toc-h1'); break;
        case 'H2': li.classList.add('toc-h2'); break;
        case 'H3': li.classList.add('toc-h3'); break;
        case 'H4': li.classList.add('toc-h4'); break;
        case 'H5': li.classList.add('toc-h5'); break;
        case 'H6': li.classList.add('toc-h6'); break;
      }

      li.appendChild(a);
      toc.appendChild(li);
      addedItems++;
    });

    // Implementar la funcionalidad de toggle
    tocToggle.addEventListener('click', function () {
      tocContainer.classList.toggle('toc-collapsed');

      // Cambiar el s√≠mbolo seg√∫n el estado
      if (tocContainer.classList.contains('toc-collapsed')) {
        tocToggle.textContent = '‚ñº';
        tocToggle.setAttribute('aria-label', 'Desplegar contenido');
        // Usar sessionStorage en lugar de localStorage para que persista solo en la sesi√≥n actual
        sessionStorage.setItem('tocState-' + window.location.pathname, 'collapsed');
      } else {
        tocToggle.textContent = '‚ñº';
        tocToggle.setAttribute('aria-label', 'Plegar contenido');
        // Usar sessionStorage y guardar el estado para esta URL espec√≠fica
        sessionStorage.setItem('tocState-' + window.location.pathname, 'expanded');
      }
    });

    // Verificar estado para esta URL espec√≠fica
    const pageSpecificState = sessionStorage.getItem('tocState-' + window.location.pathname);

    // Siempre comienza colapsado por defecto, ignoramos localStorage
    tocContainer.classList.add('toc-collapsed');
    tocToggle.textContent = '‚ñº';

    // Solo expandir si hay un estado espec√≠fico guardado para esta p√°gina
    if (pageSpecificState === 'expanded') {
      tocContainer.classList.remove('toc-collapsed');
      tocToggle.textContent = '‚ñº';
    }
  });
</script>